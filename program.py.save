import sqlite3
import random
import twitch
import time

t=twitch.Twitch();

username = "kermitlefroge";
key = "oauth:1wlvi4de2m80ennsmhbs93b3tu0xsa";
t.twitch_connect(username, key);
try:
	conn = sqlite3.connect('/home/pi/mydatabase.db')
except:
	print "Failed to open the database sucessfully";

#VVV The portion of the project that keeps the number of records up to date

cursor = conn.execute("SELECT COUNT(a) FROM questions");
NoOfRecords = (cursor.fetchone()); #Returns the number of records.
number = (NoOfRecords[0]); #Number is the number of records as an int.
randomRecord = str((random.randint(1, number)));
print(randomRecord);

#VVV Finds the random record and returns it

cursor = conn.execute("SELECT question, a, b FROM questions WHERE id = ?", (randomRecord))
for row in cursor: 
  DisplayQuestion = row[0];
  OptionOne = row[1];
  OptionTwo = row[2];
print(DisplayQuestion, OptionOne, OptionTwo);


#display the quesitonm


new_messages = t.twitch_recieve_messages();

timer = 10;
while timer > 0:
  time.sleep(1)
  print(timer)
  for message in new_messages:
            #Wuhu we got a message. Let's extract some details from it
            msg = message['message'].lower()
            username = message['username'].lower()
            print(username + ": " + msg);
  if msg == "a": optionatwitch+=1;
  if msg == "b": optionbtwitch+=1 ;
  timer -=1;
#Todo: make it so that it makes some sort of nice file?
#Google a way to export text from here into a file/server
#Maybe upload it to a local server, then can stream that...
print(optionatwitch, optionbtwitch)


print "Operation is complete";
conn.close;
